!function(){"use strict";function t(t){return`${String(t.getDate()).padStart(2,"0")}.${String(t.getMonth()+1).padStart(2,"0")}.${String(t.getFullYear()).slice(-2)} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}function e(e,o){const c={type:"text",text:e,coords:o,date:t(new Date)};a(c),n(c)}function o(e,o){const c=t(new Date),r={type:"audio",audioUrl:e.src,coords:o,date:c};a(r),n(r)}function n(t){const e=document.createElement("div");e.className="post";const o=document.createElement("div");if(o.className="post__container","text"===t.type){const e=document.createElement("p");e.className="post__text",e.textContent=t.text,o.appendChild(e)}else if("audio"===t.type){const e=new Audio(t.audioUrl);e.controls=!0,e.className="audio__player custom__audio-player",o.appendChild(e)}const n=document.createElement("div");n.className="date",n.textContent=t.date,o.appendChild(n);const a=document.createElement("div");a.className="coords",a.textContent=`[${t.coords.latitude}, ${t.coords.longitude}]`,e.appendChild(o),e.appendChild(a),document.querySelector(".timeline").prepend(e)}function a(t){const e=JSON.parse(localStorage.getItem("posts"))||[];e.push(t),localStorage.setItem("posts",JSON.stringify(e))}function c(){return new Promise(((t,e)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((e=>{const o={latitude:e.coords.latitude,longitude:e.coords.longitude};t(o)}),(()=>{e()})):e()}))}function r(t,e,o){const n=document.createElement("div");n.className="modal",n.innerHTML=`\n      <div class="modal__content">\n        <div class="modal__text">Что-то пошло не так</div>\n        <p class="modal__text">${t}</p>\n        <div class="modal__text">Широта и долгота через запятую</div>\n        <input type="text" class="manual__coords" placeholder="51.50851, -0.12572">\n        <div class="modal__btns">\n          <button class="close__modal">Отмена</button>\n          <button class="submit__coords">Ок</button>\n        </div>\n      </div>\n  `,document.body.appendChild(n),document.querySelector(".submit__coords").addEventListener("click",(()=>{const t=document.querySelector(".manual__coords").value.trim();try{const a=function(t){const e=t.match(/^\[?([-+]?[0-9]*\.?[0-9]+),\s*([-+]?[0-9]*\.?[0-9]+)\]?$/);if(!e)throw new Error("Invalid format");return{latitude:parseFloat(e[1]),longitude:parseFloat(e[2])}}(t);e(o,a),document.body.removeChild(n)}catch(t){alert("Неверный формат координат.")}})),document.querySelector(".close__modal").addEventListener("click",(()=>{document.body.removeChild(n)}))}let d,s,l;function i(){clearInterval(d)}let u=[],m=!1;function p(){const t=document.querySelector(".buttons__media");navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{l=new MediaRecorder(e),l.start(),t.style.display="none",l.addEventListener("dataavailable",(t=>{u.push(t.data)})),l.addEventListener("stop",(()=>{if(m)return u=[],m=!1,void(t.style.display="flex");const e=new Blob(u,{type:"audio/ogg; codecs=opus"}),n=URL.createObjectURL(e),a=new Audio(n);a.controls=!0,a.className="audio__player custom__audio-player",t.style.display="flex",c().then((t=>{o(a,t)})).catch((()=>{r("К сожалению, нам не удалось определить ваше местоположение, пожалуйста, дайте разрешение на использование геолокации, либо введите координаты вручную.",o,a)}))})),document.querySelector(".recording__controls").style.display="flex",clearInterval(d),s=Date.now(),d=setInterval((()=>{const t=Date.now()-s,e=String(Math.floor(t/6e4)).padStart(2,"0"),o=String(Math.floor(t%6e4/1e3)).padStart(2,"0");document.querySelector(".timer").textContent=`${e}:${o}`}),1e3)})).catch((()=>{alert("Не удалось получить доступ к микрофону.")}))}function _(){l.stop(),i(),document.querySelector(".recording__controls").style.display="none"}function y(){m=!0,l.stop(),u=[],i(),document.querySelector(".recording__controls").style.display="none"}document.addEventListener("DOMContentLoaded",(()=>{(JSON.parse(localStorage.getItem("posts"))||[]).forEach((t=>n(t)));const t=document.querySelector(".post__input");t.addEventListener("keypress",(o=>{if("Enter"===o.key&&!o.shiftKey){o.preventDefault();const n=t.value.trim();n&&c().then((o=>{e(n,o),t.value=""})).catch((()=>{r("К сожалению, нам не удалось определить ваше местоположение, пожалуйста, дайте разрешение на использование геолокации, либо введите координаты вручную.",e,n)}))}})),document.querySelector(".start__recording").addEventListener("click",p),document.querySelector(".stop__recording").addEventListener("click",_),document.querySelector(".cancel__recording").addEventListener("click",y)}))}();
//# sourceMappingURL=main.js.map